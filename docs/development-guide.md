# MacDisplayLink 개발 가이드

## 📋 프로젝트 개요

macOS에서 캡쳐 카드를 통해 외부 영상/음성 소스를 실시간으로 프리뷰하고 녹화할 수 있는 애플리케이션

---

## 🎯 핵심 기능 목표

### 1️⃣ 디바이스 인식 및 연결
- [ ] 맥에 캡쳐 카드를 꽂으면 앱에서 자동 인식
- [ ] 맥에 내장 카메라는 제외 처리
- [ ] 연결된 캡쳐 카드만 목록 표시
- [ ] 디바이스 연결/해제 상태 감지

### 2️⃣ 영상 입력 및 출력
- [ ] 캡쳐 카드에서 들어오는 영상 소스 수신
- [ ] 앱의 영상 출력부에서 실시간 프리뷰
- [ ] 출력 해상도 및 프레임레이트 설정 (ex. 1080p 60fps)
- [ ] 입력 신호 정보 표시 (현재 해상도/프레임레이트)
- [ ] 신호 없음 상태 표시

### 3️⃣ 오디오 입력 및 모니터링
- [ ] 캡쳐 카드에서 들어오는 음성 소스 수신
- [ ] 스피커를 통한 오디오 모니터링
- [ ] 오디오 볼륨 조절 기능
- [ ] 오디오 레벨 미터 표시

### 4️⃣ 녹화 및 저장
- [ ] 영상 + 음성 동시 녹화
- [ ] 녹화 시작/정지 기능
- [ ] 저장 포맷 선택 (MP4, MOV 등)
- [ ] 코덱 선택 (H.264, H.265 등)
- [ ] 비트레이트 설정
- [ ] 저장 경로 지정
- [ ] 자동 파일명 생성 (날짜/시간 기반)
- [ ] 녹화 상태 표시 (시간, 파일 크기)

---

## 🗓️ 개발 로드맵

### Phase 1: MVP (최소 기능 제품)
**목표: 기본적인 캡쳐 및 녹화 기능 구현**

- [ ] AVFoundation을 이용한 캡쳐 카드 인식
- [ ] 비디오 입력 스트림 수신 및 프리뷰
- [ ] 오디오 입력 스트림 수신 및 재생
- [ ] 기본 녹화 기능 (고정 설정)
- [ ] 파일 저장 기능

### Phase 2: 설정 및 제어
**목표: 사용자 설정 및 제어 기능 추가**

- [ ] 해상도/프레임레이트 설정 UI
- [ ] 저장 포맷 및 코덱 선택
- [ ] 오디오 볼륨 컨트롤
- [ ] 저장 경로 설정
- [ ] 단축키 지원 (녹화 시작/정지)

### Phase 3: 편의 기능
**목표: 사용성 향상 및 부가 기능**

- [ ] 스크린샷 기능
- [ ] 오디오 레벨 미터 시각화
- [ ] 저장 공간 확인 및 경고
- [ ] 최근 녹화 파일 목록
- [ ] 다중 디바이스 지원

### Phase 4: 고급 기능
**목표: 전문적인 기능 추가**

- [ ] 오디오 입력 소스 믹싱
- [ ] 화면 회전/반전 옵션
- [ ] 타임스탬프/워터마크 오버레이
- [ ] 프리뷰 품질 설정

---

## 🛠️ 기술 스택

### 프레임워크
- **SwiftUI**: UI 구현
- **AVFoundation**: 비디오/오디오 캡쳐 및 녹화
- **CoreMedia**: 미디어 데이터 처리

### 주요 클래스
- `AVCaptureDevice`: 캡쳐 디바이스 인식
- `AVCaptureSession`: 캡쳐 세션 관리
- `AVCaptureVideoPreviewLayer`: 비디오 프리뷰
- `AVAssetWriter`: 미디어 파일 저장
- `AVAudioEngine`: 오디오 처리

---

## 🎨 UI/UX 요구사항

### 메인 화면
- 비디오 프리뷰 영역 (중앙)
- 녹화 시작/정지 버튼
- 녹화 시간 표시
- 오디오 볼륨 슬라이더
- 오디오 레벨 미터

### 설정 화면
- 캡쳐 디바이스 선택
- 출력 해상도/프레임레이트 설정
- 저장 포맷 및 코덱 선택
- 비트레이트 설정
- 저장 경로 설정

### 상태 표시
- 디바이스 연결 상태
- 입력 신호 정보
- 녹화 진행 상태
- 저장 공간 정보

---

## ⚠️ 에러 처리

### 필수 에러 핸들링
- [ ] 캡쳐 카드 연결 해제 감지 및 처리
- [ ] 신호 끊김 감지 (녹화 중)
- [ ] 디스크 공간 부족 경고 및 자동 정지
- [ ] 권한 요청 실패 처리 (카메라, 마이크, 파일 접근)
- [ ] 지원하지 않는 해상도/프레임레이트 처리

---

## 🔐 권한 요구사항

### Info.plist 설정
- `NSCameraUsageDescription`: 비디오 캡쳐 권한
- `NSMicrophoneUsageDescription`: 오디오 캡쳐 권한

---

## 📝 개발 체크리스트

### 시작하기 전
- [ ] Xcode 프로젝트 설정 확인
- [ ] AVFoundation 프레임워크 추가
- [ ] 권한 설정 (Info.plist)
- [ ] 캡쳐 카드 연결 테스트

### 개발 중
- [ ] 코드 커밋 시 commit-guide.md 준수
- [ ] 기능 브랜치 사용 (branch-guide.md 참고)
- [ ] 각 기능 완료 시 테스트

### 배포 전
- [ ] 모든 에러 처리 확인
- [ ] 메모리 누수 체크
- [ ] 다양한 캡쳐 카드로 테스트
- [ ] 다양한 해상도/프레임레이트 테스트

---

## 📚 참고 자료

### Apple 공식 문서
- [AVFoundation Programming Guide](https://developer.apple.com/av-foundation/)
- [AVCaptureSession](https://developer.apple.com/documentation/avfoundation/avcapturesession)
- [AVAssetWriter](https://developer.apple.com/documentation/avfoundation/avassetwriter)

### 샘플 프로젝트
- [AVCam: Building a Camera App](https://developer.apple.com/documentation/avfoundation/avcam_building_a_camera_app)

---

## 🔄 문서 업데이트

이 문서는 프로젝트 진행에 따라 지속적으로 업데이트됩니다.
- 새로운 기능 추가 시 체크리스트에 추가
- 완료된 기능은 체크 표시
- 기술적 결정 사항 기록